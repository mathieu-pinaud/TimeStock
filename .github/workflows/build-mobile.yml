name: Build MAUI Android & iOS

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  build-android:
    runs-on: ubuntu-latest
    steps:
      - name: Installer .NET SDK depuis Microsoft
        run: |
          curl -fsSL https://dot.net/v1/dotnet-install.sh | bash /dev/stdin --install-dir $HOME/.dotnet --version 8.0.112
          echo "DOTNET_ROOT=$HOME/.dotnet" >> $GITHUB_ENV
          echo "$HOME/.dotnet" >> $GITHUB_PATH

      - name: Vérifier .NET et installer MAUI Android
        run: |
          dotnet --version
          dotnet workload install maui maui-android
          dotnet workload restore

      - name: Checkout du code
        uses: actions/checkout@v4

      - name: Build de l’application Android
        run: |
          cd src/Mobile
          dotnet publish -f net8.0-android -c Release -o out

      - name: Upload du build Android
        uses: actions/upload-artifact@v4
        with:
          name: android-build
          path: src/Mobile/out

  build-ios:
    runs-on: macos-latest
    steps:
      - name: Checkout du code
        uses: actions/checkout@v4

      - name: Installer .NET et MAUI iOS
        run: |
          brew install --cask dotnet-sdk
          dotnet --version
          dotnet workload install maui maui-ios
          dotnet workload restore

      - name: Build de l’application iOS
        run: |
          cd src/Mobile
          dotnet publish -f net8.0-ios -c Release -o out

      - name: Upload du build iOS
        uses: actions/upload-artifact@v4
        with:
          name: ios-build
          path: src/Mobile/out
